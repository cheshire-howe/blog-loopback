!function(){"use strict";function a(a,b,c){function d(){a.isCollapsed=!0}function e(){c.getCurrent().$promise.then(function(b){a.isLoggedIn=!0,g.userId=b.id},function(){a.isLoggedIn=!1})}function f(){var a={filter:{include:{relation:"user",scope:{fields:["username"]}}}};b.find(a).$promise.then(function(a){g.posts=a})}var g=this;g.posts=[],g.collapse=d,g.userId="",e(),f()}function b(a,b,c,d){function e(){d.getCurrent().$promise.then(function(b){a.isLoggedIn=!0,g.userId=b.id},function(){a.isLoggedIn=!1})}function f(){g.newPost.userId=g.userId,c.create(g.newPost).$promise.then(function(){g.postForm.$setPristine(),b.go("blog")})}var g=this;g.addPost=f,g.newPost=g.newPost||{},e()}function c(a,b,c,d,e,f,g){g.getCurrent().$promise.then(function(c){a.isLoggedIn=!0,b.userId=c.id},function(){a.isLoggedIn=!1}),b.post=e.findOne({filter:{where:{id:c.id},include:"user"}},function(){b.comments=e.comments({id:c.id})}),b.deletePost=function(){e.comments.destroyAll({id:b.post.id}).$promise.then(function(){g.posts.destroyById({id:b.userId,fk:b.post.id}).$promise.then(function(){d.go("blog")})})},b.addComment=function(){e.comments.create({id:b.post.id},{content:b.newComment.content,userId:b.userId}).$promise.then(function(a){b.newComment="",b.commentForm.$setPristine(),b.comments.push(a)})},b.editComment=function(a,c,d){g.comments.updateById({fk:c,id:b.userId},{content:a}).$promise.then(function(){},function(){b.comments[d]=f.findById({id:c})})},b.deleteComment=function(a,c){g.comments.destroyById({fk:a,id:b.userId}).$promise.then(function(){b.comments.splice(c,1)})}}function d(a,b,c,d,e,f){f.getCurrent().$promise.then(function(c){a.isLoggedIn=!0,b.userId=c.id},function(){a.isLoggedIn=!1}),b.newPost=e.get({id:c.id}),b.editPost=function(a){f.posts.updateById({id:b.userId,fk:c.id},{title:a.title,content:a.content}).$promise.then(function(){d.go("postDetail",{id:c.id})})}}var e=angular.module("blogApp.controllers.postCtrls",["lbServices"]);e.controller("PostCtrl",a),a.$inject=["$rootScope","Post","User"],e.controller("PostCreateCtrl",b),b.$inject=["$rootScope","$state","Post","User"],e.controller("PostDetailCtrl",c),c.$inject=["$rootScope","$scope","$stateParams","$state","Post","Comment","User"],e.controller("PostEditCtrl",d),d.$inject=["$rootScope","$scope","$stateParams","$state","Post","User"]}();