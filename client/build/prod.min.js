"use strict";var blogControllers=angular.module("blogControllers",[]);blogControllers.controller("PostCtrl",["$rootScope","$scope","Post","User",function(a,b,c,d){d.getCurrent().$promise.then(function(){a.isLoggedIn=!0},function(){a.isLoggedIn=!1}),b.collapse=function(){a.isCollapsed=!0},b.posts=[],c.find().$promise.then(function(a){b.posts=a})}]),blogControllers.controller("PostCreateCtrl",["$rootScope","$scope","$state","Post","User",function(a,b,c,d,e){e.getCurrent().$promise.then(function(c){a.isLoggedIn=!0,b.userId=c.id},function(){a.isLoggedIn=!1}),b.addPost=function(){b.newPost.userId=b.userId,d.create(b.newPost).$promise.then(function(){b.postForm.$setPristine(),c.go("blog")})}}]),blogControllers.controller("PostDetailCtrl",["$rootScope","$scope","$stateParams","$state","Post","User",function(a,b,c,d,e,f){function g(){b.comments=e.prototype$__get__comments({id:c.id})}f.getCurrent().$promise.then(function(c){a.isLoggedIn=!0,b.userId=c.id},function(){a.isLoggedIn=!1}),b.post=e.get({id:c.id}),g(),b.deletePost=function(a){e.deleteById({id:a}).$promise.then(function(){d.go("blog")})},b.addComment=function(){e.prototype$__create__comments({id:b.post.id},{content:b.newComment.content,userId:b.userId}).$promise.then(function(){b.newComment="",b.commentForm.$setPristine(),g()})},b.editComment=function(a,c){e.prototype$__updateById__comments({fk:c,id:b.post.id},{content:a,userId:b.userId})},b.deleteComment=function(a){e.prototype$__destroyById__comments({fk:a,id:b.post.id}).$promise.then(function(){g()})}}]),blogControllers.controller("PostEditCtrl",["$rootScope","$scope","$stateParams","$state","Post","User",function(a,b,c,d,e,f){f.getCurrent().$promise.then(function(c){a.isLoggedIn=!0,b.userId=c.id},function(){a.isLoggedIn=!1}),b.newPost=e.get({id:c.id}),b.editPost=function(){b.newPost.$save(function(){d.go("postDetail",{id:c.id})})}}]),blogControllers.controller("UserRegisterCtrl",["$rootScope","$scope","$state","User",function(a,b,c,d){d.getCurrent().$promise.then(function(d){a.isLoggedIn=!0,b.userId=d.id,c.go("blog")},function(){a.isLoggedIn=!1}),b.register=function(){var a={email:b.newUser.email,password:b.newUser.password};d.create(a).$promise.then(function(){d.login(a,function(){c.go("blog")})})}}]),blogControllers.controller("UserLoginCtrl",["$rootScope","$scope","$state","User",function(a,b,c,d){d.getCurrent().$promise.then(function(d){a.isLoggedIn=!0,b.userId=d.id,c.go("blog")},function(){a.isLoggedIn=!1}),b.login=function(){d.login({email:b.user.email,password:b.user.password}).$promise.then(function(){b.loginFail=!1,a.isLoggedIn=!0,c.go("blog")},function(){b.loginFail=!0})}}]),blogControllers.controller("UserLogoutCtrl",["$rootScope","$state","User",function(a,b,c){c.logout().$promise.then(function(){a.isLoggedIn=!1,b.go("blog")})}]),angular.module("blogDirectives",[]).directive("compareTo",[function(){return{require:"ngModel",scope:{otherModelValue:"=compareTo"},link:function(a,b,c,d){d.$validators.compareTo=function(b){return b===a.otherModelValue},a.$watch("otherModelValue",function(){d.$validate()})}}}]).directive("ngReallyClick",[function(){return{restrict:"A",link:function(a,b,c){b.bind("click",function(){var b=c.ngReallyMessage;b&&confirm(b)&&a.$apply(c.ngReallyClick)})}}}]),function(a,b,c){var d="/api",e="authorization",f=b.module("lbServices",["ngResource"]);f.factory("User",["LoopBackResource","LoopBackAuth","$injector",function(a,b){var c=a(d+"/Users/:id",{id:"@id"},{login:{params:{include:"user"},interceptor:{response:function(a){var c=a.data;return b.setUser(c.id,c.userId,c.user),b.rememberMe=a.config.params.rememberMe!==!1,b.save(),a.resource}},url:d+"/Users/login",method:"POST"},logout:{interceptor:{response:function(a){return b.clearUser(),b.clearStorage(),a.resource}},url:d+"/Users/logout",method:"POST"},confirm:{url:d+"/Users/confirm",method:"GET"},resetPassword:{url:d+"/Users/reset",method:"POST"},prototype$__findById__accessTokens:{url:d+"/Users/:id/accessTokens/:fk",method:"GET"},prototype$__destroyById__accessTokens:{url:d+"/Users/:id/accessTokens/:fk",method:"DELETE"},prototype$__updateById__accessTokens:{url:d+"/Users/:id/accessTokens/:fk",method:"PUT"},prototype$__get__accessTokens:{isArray:!0,url:d+"/Users/:id/accessTokens",method:"GET"},prototype$__create__accessTokens:{url:d+"/Users/:id/accessTokens",method:"POST"},prototype$__delete__accessTokens:{url:d+"/Users/:id/accessTokens",method:"DELETE"},prototype$__count__accessTokens:{url:d+"/Users/:id/accessTokens/count",method:"GET"},create:{url:d+"/Users",method:"POST"},upsert:{url:d+"/Users",method:"PUT"},exists:{url:d+"/Users/:id/exists",method:"GET"},findById:{url:d+"/Users/:id",method:"GET"},find:{isArray:!0,url:d+"/Users",method:"GET"},findOne:{url:d+"/Users/findOne",method:"GET"},updateAll:{url:d+"/Users/update",method:"POST"},deleteById:{url:d+"/Users/:id",method:"DELETE"},count:{url:d+"/Users/count",method:"GET"},prototype$updateAttributes:{url:d+"/Users/:id",method:"PUT"},"::get::Post::user":{url:d+"/Posts/:id/user",method:"GET"},getCurrent:{url:d+"/Users/:id",method:"GET",params:{id:function(){var a=b.currentUserId;return null==a&&(a="__anonymous__"),a}},interceptor:{response:function(a){return b.currentUserData=a.data,a.resource}},__isGetCurrentUser__:!0}});return c.updateOrCreate=c.upsert,c.update=c.updateAll,c.destroyById=c.deleteById,c.removeById=c.deleteById,c.getCachedCurrent=function(){var a=b.currentUserData;return a?new c(a):null},c.isAuthenticated=function(){return null!=this.getCurrentId()},c.getCurrentId=function(){return b.currentUserId},c.modelName="User",c}]),f.factory("Post",["LoopBackResource","LoopBackAuth","$injector",function(a,b,c){var e=a(d+"/Posts/:id",{id:"@id"},{prototype$__get__user:{url:d+"/Posts/:id/user",method:"GET"},prototype$__findById__comments:{url:d+"/Posts/:id/comments/:fk",method:"GET"},prototype$__destroyById__comments:{url:d+"/Posts/:id/comments/:fk",method:"DELETE"},prototype$__updateById__comments:{url:d+"/Posts/:id/comments/:fk",method:"PUT"},prototype$__get__comments:{isArray:!0,url:d+"/Posts/:id/comments",method:"GET"},prototype$__create__comments:{url:d+"/Posts/:id/comments",method:"POST"},prototype$__delete__comments:{url:d+"/Posts/:id/comments",method:"DELETE"},prototype$__count__comments:{url:d+"/Posts/:id/comments/count",method:"GET"},create:{url:d+"/Posts",method:"POST"},upsert:{url:d+"/Posts",method:"PUT"},exists:{url:d+"/Posts/:id/exists",method:"GET"},findById:{url:d+"/Posts/:id",method:"GET"},find:{isArray:!0,url:d+"/Posts",method:"GET"},findOne:{url:d+"/Posts/findOne",method:"GET"},updateAll:{url:d+"/Posts/update",method:"POST"},deleteById:{url:d+"/Posts/:id",method:"DELETE"},count:{url:d+"/Posts/count",method:"GET"},prototype$updateAttributes:{url:d+"/Posts/:id",method:"PUT"}});return e.updateOrCreate=e.upsert,e.update=e.updateAll,e.destroyById=e.deleteById,e.removeById=e.deleteById,e.modelName="Post",e.user=function(){var a=c.get("User"),b=a["::get::Post::user"];return b.apply(e,arguments)},e}]),f.factory("LoopBackAuth",function(){function a(){var a=this;e.forEach(function(b){a[b]=d(b)}),this.rememberMe=c,this.currentUserData=null}function b(a,b,c){var d=f+b;null==c&&(c=""),a[d]=c}function d(a){var b=f+a;return localStorage[b]||sessionStorage[b]||null}var e=["accessTokenId","currentUserId"],f="$LoopBack$";return a.prototype.save=function(){var a=this,c=this.rememberMe?localStorage:sessionStorage;e.forEach(function(d){b(c,d,a[d])})},a.prototype.setUser=function(a,b,c){this.accessTokenId=a,this.currentUserId=b,this.currentUserData=c},a.prototype.clearUser=function(){this.accessTokenId=null,this.currentUserId=null,this.currentUserData=null},a.prototype.clearStorage=function(){e.forEach(function(a){b(sessionStorage,a,null),b(localStorage,a,null)})},new a}).config(["$httpProvider",function(a){a.interceptors.push("LoopBackAuthRequestInterceptor")}]).factory("LoopBackAuthRequestInterceptor",["$q","LoopBackAuth",function(a,b){return{request:function(f){if(f.url.substr(0,d.length)!==d)return f;if(b.accessTokenId)f.headers[e]=b.accessTokenId;else if(f.__isGetCurrentUser__){var g={body:{error:{status:401}},status:401,config:f,headers:function(){return c}};return a.reject(g)}return f||a.when(f)}}}]).provider("LoopBackResource",function(){this.setAuthHeader=function(a){e=a},this.setUrlBase=function(a){d=a},this.$get=["$resource",function(a){return function(b,c,d){var e=a(b,c,d);return e.prototype.$save=function(a,b){var c=e.upsert.call(this,{},this,a,b);return c.$promise||c},e}}]})}(window,window.angular);var blogApp=angular.module("blogApp",["lbServices","ui.router","ui.bootstrap","xeditable","blogControllers","blogDirectives"]);blogApp.run(function(a){a.theme="bs3"}),blogApp.config(["$stateProvider","$urlRouterProvider","$locationProvider",function(a,b,c){a.state("blog",{url:"/",templateUrl:"js/blog/templates/posts.html",controller:"PostCtrl"}).state("postCreate",{url:"/Post/create",templateUrl:"js/blog/templates/create.html",controller:"PostCreateCtrl"}).state("postDetail",{url:"/Post/:id",templateUrl:"js/blog/templates/detail.html",controller:"PostDetailCtrl"}).state("postEdit",{url:"/Post/:id/edit",templateUrl:"js/blog/templates/edit.html",controller:"PostEditCtrl"}).state("register",{url:"/userRegister",templateUrl:"js/users/templates/register.html",controller:"UserRegisterCtrl"}).state("login",{url:"/userLogin",templateUrl:"js/users/templates/login.html",controller:"UserLoginCtrl"}).state("logout",{url:"/userLogout",controller:"UserLogoutCtrl"}),b.otherwise("/"),c.html5Mode(!0)}]);